{% extends "base.html" %}
{% load static %}

{% block title %}Inscription | Plateforme Emploi & Stages{% endblock %}

{% block content %}
<style>
/* ================= Container et Fond ================= */
.register-container {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background: url("{% static 'images/bg_login.jpg' %}") no-repeat center center/cover;
}

/* ================= Card ================= */
.register-card {
    position: relative;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 122, 255, 0.2);
    border-radius: 20px;
    padding: 40px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    color: #333;
}

.register-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
    background: linear-gradient(90deg, #007aff, #4da3ff, #007aff);
    border-radius: 20px 20px 0 0;
    box-shadow: 0 0 12px rgba(0, 122, 255, 0.8);
}

/* ================= Inputs ================= */
.register-card input,
.register-card select {
    width: 100%;
    border-radius: 10px;
    padding: 12px;
    border: 1px solid #ddd;
    margin-bottom: 10px;
}

/* ================= Buttons ================= */
.btn-register {
    background: #007bff;
    border: none;
    border-radius: 10px;
    padding: 12px;
    font-weight: 600;
    width: 100%;
    color: white;
    text-transform: uppercase;
    transition: 0.3s;
}

.btn-register:hover {
    background: #0056b3;
    transform: translateY(-2px);
}

.register-link {
    color: #007bff;
    text-decoration: none;
    font-weight: bold;
}

/* ================= Champs légaux et entreprise ================= */
#legal-docs, #company-fields {
    display: none;
    margin-top: 10px;
}

/* ================= Fond animé ================= */
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(-45deg, #007aff, #4da3ff, #00ffcc, #00ffaa);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    z-index: -1;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}
</style>

<div class="register-container">
    <div class="register-card">
        <h2 class="text-center fw-bold mb-4" style="letter-spacing: 2px;">INSCRIPTION</h2>

        <form method="post" action="{% url 'register' %}" enctype="multipart/form-data">
            {% csrf_token %}

            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} p-2 small text-center">{{ message }}</div>
                {% endfor %}
            {% endif %}

            <!-- Username -->
            <div class="mb-3">
                <label class="form-label fw-bold small">Nom d'utilisateur</label>
                <input type="text" name="username" id="id_username"
                       class="form-control"
                       placeholder="Votre nom d'utilisateur"
                       value="{{ form.username.value|default_if_none:'' }}">
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label class="form-label fw-bold small">Email</label>
                <input type="email" name="email" id="id_email"
                       class="form-control"
                       placeholder="Votre adresse email"
                       value="{{ form.email.value|default_if_none:'' }}">
            </div>

            <!-- Role -->
            <div class="mb-3">
                <label class="form-label fw-bold small">Je suis</label>
                <select name="role" id="id_role" class="form-control" onchange="toggleFields(this.value)">
                    <option value="" disabled {% if not form.role.value %}selected{% endif %}>Choisir un rôle</option>
                    <option value="candidat" {% if form.role.value == 'candidat' %}selected{% endif %}>Candidat</option>
                    <option value="recruteur" {% if form.role.value == 'recruteur' %}selected{% endif %}>Recruteur</option>
                </select>
            </div>

            <!-- Champs supplémentaires pour Recruteur -->
            <div id="company-fields">
                <div class="mb-3">
                    <label class="form-label fw-bold small">Nom de l'entreprise</label>
                    <input type="text" name="company_name" class="form-control" placeholder="Nom de votre entreprise">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold small">Domaine</label>
                    <input type="text" name="company_domain" class="form-control" placeholder="Domaine de l'entreprise">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold small">Ville</label>
                    <input type="text" name="company_city" class="form-control" placeholder="Ville de l'entreprise">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold small">Contacts</label>
                    <input type="text" name="company_contact" class="form-control" placeholder="Contacts de l'entreprise">
                </div>
            </div>

            <!-- Preuve légale -->
            <div id="legal-docs">
                <label class="form-label fw-bold small">Preuve légale de l'entreprise (CNI, RCCM, etc.)</label>
                <input type="file" name="legal_document" class="form-control" accept="image/*,.pdf">
            </div>

            <!-- Password -->
            <div class="mb-3">
                <label class="form-label fw-bold small">Mot de passe</label>
                <input type="password" name="password1" placeholder="Votre mot de passe" class="form-control">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold small">Confirmer le mot de passe</label>
                <input type="password" name="password2" placeholder="Confirmer le mot de passe" class="form-control">
            </div>

            <button type="submit" class="btn btn-register shadow">S'inscrire</button>
        </form>

        <div class="mt-4 text-center border-top pt-3">
            <p class="mb-1 small text-muted">Vous avez déjà un compte ?</p>
            <a href="{% url 'login' %}" class="register-link">SE CONNECTER</a>
        </div>
    </div>
</div>

<script>
function toggleFields(role) {
    const legalDiv = document.getElementById('legal-docs');
    const companyDiv = document.getElementById('company-fields');

    if(role === 'recruteur') {
        legalDiv.style.display = 'block';
        companyDiv.style.display = 'block';
    } else {
        legalDiv.style.display = 'none';
        companyDiv.style.display = 'none';
    }
}

// Afficher les champs si le formulaire est rechargé avec "recruteur" sélectionné
window.addEventListener('load', () => {
    const roleSelect = document.getElementById('id_role');
    toggleFields(roleSelect.value);
});
</script>
{% endblock %}

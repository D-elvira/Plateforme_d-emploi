{% extends "admin/admin_base.html" %}

{% block page_title %}Candidatures{% endblock %}
{% block page_subtitle %}Toutes les candidatures reçues{% endblock %}

{% block admin_content %}
<div class="flex items-center justify-between mb-6">
    <span class="text-sm text-gray-500">Total : <strong class="text-gray-900">{{ candidatures|length }}</strong>
        candidatures</span>
</div>

<div class="bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm">
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead>
                <tr class="text-xs uppercase text-gray-400 border-b border-gray-100 bg-gray-50/50">
                    <th class="px-6 py-3.5 text-left font-semibold">Candidat</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Email</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Offre</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Message</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Date</th>
                    <th class="px-6 py-3.5 text-center font-semibold">CV</th>
                    <th class="px-6 py-3.5 text-center font-semibold">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for c in candidatures %}
                <tr class="table-row border-b border-gray-50">
                    <td class="px-6 py-3.5">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-8 h-8 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                {{ c.nom_complet|first|upper }}</div>
                            <span class="font-semibold text-gray-900">{{ c.nom_complet }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-3.5 text-gray-500">{{ c.email }}</td>
                    <td class="px-6 py-3.5">
                        <a href="{% url 'offre_detail' c.offre.id %}"
                            class="text-blue-600 hover:text-blue-700 font-medium">{{ c.offre.titre|truncatewords:4 }}</a>
                    </td>
                    <td class="px-6 py-3.5 text-gray-500 max-w-[200px] truncate">{{ c.message|truncatewords:8|default:"-" }}</td>
                    <td class="px-6 py-3.5 text-gray-400 text-xs">{{ c.date_envoi|date:"d M Y" }}</td>
                    <td class="px-6 py-3.5 text-center">
                        {% if c.cv %}
                        <a href="{{ c.cv.url }}" target="_blank" class="text-blue-500 hover:text-blue-700"
                            title="Télécharger CV">
                            <i class="bi bi-file-earmark-arrow-down-fill text-lg"></i>
                        </a>
                        {% else %}
                        <span class="text-gray-300">—</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-3.5 text-center">
                        <form method="POST" action="{% url 'admin_delete_candidature' c.id %}"
                            onsubmit="return confirm('Supprimer cette candidature ?')">
                            {% csrf_token %}
                            <button type="submit" class="text-red-400 hover:text-red-600 transition-colors"
                                title="Supprimer">
                                <i class="bi bi-trash3-fill"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-12 text-center text-gray-400">Aucune candidature trouvée</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
{% extends "admin/admin_base.html" %}

{% block page_title %}Utilisateurs{% endblock %}
{% block page_subtitle %}Gestion de tous les utilisateurs{% endblock %}

{% block admin_content %}
<div class="flex items-center justify-between mb-6">
    <div class="flex items-center space-x-4">
        <span class="text-sm text-gray-500">Total : <strong class="text-gray-900">{{ users|length }}</strong></span>
        <span class="text-sm text-gray-500">Candidats : <strong class="text-emerald-600"
                id="count-candidats">0</strong></span>
        <span class="text-sm text-gray-500">Recruteurs : <strong class="text-purple-600"
                id="count-recruteurs">0</strong></span>
    </div>
</div>

<div class="bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm">
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead>
                <tr class="text-xs uppercase text-gray-400 border-b border-gray-100 bg-gray-50/50">
                    <th class="px-6 py-3.5 text-left font-semibold">Utilisateur</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Email</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Rôle</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Domaine</th>
                    <th class="px-6 py-3.5 text-left font-semibold">Inscription</th>
                    <th class="px-6 py-3.5 text-center font-semibold">Statut</th>
                    <th class="px-6 py-3.5 text-center font-semibold">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr class="table-row border-b border-gray-50" data-role="{{ u.role }}">
                    <td class="px-6 py-3.5">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-8 h-8 bg-gradient-to-tr from-blue-500 to-indigo-500 rounded-full flex items-center justify-center text-white text-xs font-bold">
                                {{ u.username|first|upper }}</div>
                            <span class="font-semibold text-gray-900">{{ u.username }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-3.5 text-gray-500">{{ u.email }}</td>
                    <td class="px-6 py-3.5">
                        <span
                            class="px-2.5 py-1 rounded-full text-[10px] font-bold uppercase {% if u.role == 'candidat' %}bg-emerald-50 text-emerald-700{% elif u.role == 'recruteur' %}bg-purple-50 text-purple-700{% else %}bg-gray-100 text-gray-600{% endif %}">{{ u.role|default:"admin" }}</span>
                    </td>
                    <td class="px-6 py-3.5 text-gray-500">{{ u.domaine_activite|default:"-" }}</td>
                    <td class="px-6 py-3.5 text-gray-400 text-xs">{{ u.date_joined|date:"d M Y" }}</td>
                    <td class="px-6 py-3.5 text-center">
                        {% if u.is_active %}
                        <span class="inline-block w-2.5 h-2.5 bg-emerald-500 rounded-full" title="Actif"></span>
                        {% else %}
                        <span class="inline-block w-2.5 h-2.5 bg-red-400 rounded-full" title="Inactif"></span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-3.5 text-center">
                        {% if not u.is_superuser %}
                        <form method="POST" action="{% url 'admin_delete_user' u.id %}"
                            onsubmit="return confirm('Supprimer {{ u.username }} ?')">
                            {% csrf_token %}
                            <button type="submit" class="text-red-400 hover:text-red-600 transition-colors"
                                title="Supprimer">
                                <i class="bi bi-trash3-fill"></i>
                            </button>
                        </form>
                        {% else %}
                        <span class="text-xs text-gray-300">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-12 text-center text-gray-400">Aucun utilisateur trouvé</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rows = document.querySelectorAll('tr[data-role]');
        let c = 0, r = 0;
        rows.forEach(row => { if (row.dataset.role === 'candidat') c++; else if (row.dataset.role === 'recruteur') r++; });
        document.getElementById('count-candidats').textContent = c;
        document.getElementById('count-recruteurs').textContent = r;
    });
</script>
{% endblock %}